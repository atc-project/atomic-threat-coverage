| Title                | Malicious PowerShell Commandlet Names                                                                                                                                                 |
|:---------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Description          | Detects the creation of known powershell scripts for exploitation                                                                                                                                           |
| ATT&amp;CK Tactic    |  <ul><li>[TA0002: Execution](https://attack.mitre.org/tactics/TA0002)</li></ul>  |
| ATT&amp;CK Technique | <ul><li>[T1086: PowerShell](https://attack.mitre.org/techniques/T1086)</li></ul>  |
| Data Needed          | <ul><li>[DN_0015_11_windows_sysmon_FileCreate](../Data_Needed/DN_0015_11_windows_sysmon_FileCreate.md)</li></ul>  |
| Enrichment           |  Data for this Detection Rule doesn't require any Enrichments.  |
| Trigger              | <ul><li>[T1086: PowerShell](../Triggers/T1086.md)</li></ul>  |
| Severity Level       | high |
| False Positives      | <ul><li>Penetration Tests</li></ul>  |
| Development Status   | experimental |
| References           | <ul><li>[https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml](https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml)</li></ul>  |
| Author               | Markus Neis |


## Detection Rules

### Sigma rule

```
title: Malicious PowerShell Commandlet Names
status: experimental
description: Detects the creation of known powershell scripts for exploitation
references:
    - https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml
tags:
    - attack.execution
    - attack.t1086
author: Markus Neis
date: 2018/04/07
logsource:
    product: windows
    service: sysmon
detection:
    selection:
        EventID: 11
        TargetFilename:
            - '*\Invoke-DllInjection.ps1'   
            - '*\Invoke-WmiCommand.ps1'
            - '*\Get-GPPPassword.ps1'
            - '*\Get-Keystrokes.ps1'
            - '*\Get-VaultCredential.ps1'
            - '*\Invoke-CredentialInjection.ps1'
            - '*\Invoke-Mimikatz.ps1'
            - '*\Invoke-NinjaCopy.ps1'
            - '*\Invoke-TokenManipulation.ps1'
            - '*\Out-Minidump.ps1'
            - '*\VolumeShadowCopyTools.ps1'
            - '*\Invoke-ReflectivePEInjection.ps1'
            - '*\Get-TimedScreenshot.ps1'
            - '*\Invoke-UserHunter.ps1'
            - '*\Find-GPOLocation.ps1'
            - '*\Invoke-ACLScanner.ps1'
            - '*\Invoke-DowngradeAccount.ps1'
            - '*\Get-ServiceUnquoted.ps1'
            - '*\Get-ServiceFilePermission.ps1'
            - '*\Get-ServicePermission.ps1'
            - '*\Invoke-ServiceAbuse.ps1'
            - '*\Install-ServiceBinary.ps1'
            - '*\Get-RegAutoLogon.ps1'
            - '*\Get-VulnAutoRun.ps1'
            - '*\Get-VulnSchTask.ps1'
            - '*\Get-UnattendedInstallFile.ps1'
            - '*\Get-WebConfig.ps1'
            - '*\Get-ApplicationHost.ps1'
            - '*\Get-RegAlwaysInstallElevated.ps1'
            - '*\Get-Unconstrained.ps1'
            - '*\Add-RegBackdoor.ps1'
            - '*\Add-ScrnSaveBackdoor.ps1'
            - '*\Gupt-Backdoor.ps1'
            - '*\Invoke-ADSBackdoor.ps1'
            - '*\Enabled-DuplicateToken.ps1'
            - '*\Invoke-PsUaCme.ps1'
            - '*\Remove-Update.ps1'
            - '*\Check-VM.ps1'
            - '*\Get-LSASecret.ps1'
            - '*\Get-PassHashes.ps1'
            - '*\Show-TargetScreen.ps1'
            - '*\Port-Scan.ps1'
            - '*\Invoke-PoshRatHttp.ps1'
            - '*\Invoke-PowerShellTCP.ps1'
            - '*\Invoke-PowerShellWMI.ps1'
            - '*\Add-Exfiltration.ps1'
            - '*\Add-Persistence.ps1'
            - '*\Do-Exfiltration.ps1'
            - '*\Start-CaptureServer.ps1'
            - '*\Invoke-ShellCode.ps1'
            - '*\Get-ChromeDump.ps1'
            - '*\Get-ClipboardContents.ps1'
            - '*\Get-FoxDump.ps1'
            - '*\Get-IndexedItem.ps1'
            - '*\Get-Screenshot.ps1'
            - '*\Invoke-Inveigh.ps1'
            - '*\Invoke-NetRipper.ps1'
            - '*\Invoke-EgressCheck.ps1'
            - '*\Invoke-PostExfil.ps1'
            - '*\Invoke-PSInject.ps1'
            - '*\Invoke-RunAs.ps1'
            - '*\MailRaider.ps1'
            - '*\New-HoneyHash.ps1'
            - '*\Set-MacAttribute.ps1'
            - '*\Invoke-DCSync.ps1'
            - '*\Invoke-PowerDump.ps1'
            - '*\Exploit-Jboss.ps1'
            - '*\Invoke-ThunderStruck.ps1'
            - '*\Invoke-VoiceTroll.ps1'
            - '*\Set-Wallpaper.ps1'
            - '*\Invoke-InveighRelay.ps1'
            - '*\Invoke-PsExec.ps1'
            - '*\Invoke-SSHCommand.ps1'
            - '*\Get-SecurityPackages.ps1'
            - '*\Install-SSP.ps1'
            - '*\Invoke-BackdoorLNK.ps1'
            - '*\PowerBreach.ps1'
            - '*\Get-SiteListPassword.ps1'
            - '*\Get-System.ps1'
            - '*\Invoke-BypassUAC.ps1'
            - '*\Invoke-Tater.ps1'
            - '*\Invoke-WScriptBypassUAC.ps1'
            - '*\PowerUp.ps1'
            - '*\PowerView.ps1'
            - '*\Get-RickAstley.ps1'
            - '*\Find-Fruit.ps1'
            - '*\HTTP-Login.ps1'
            - '*\Find-TrustedDocuments.ps1'
            - '*\Invoke-Paranoia.ps1'
            - '*\Invoke-WinEnum.ps1'
            - '*\Invoke-ARPScan.ps1'
            - '*\Invoke-PortScan.ps1'
            - '*\Invoke-ReverseDNSLookup.ps1'
            - '*\Invoke-SMBScanner.ps1'
            - '*\Invoke-Mimikittenz.ps1'
    condition: selection
falsepositives:
    - Penetration Tests
level: high
        

```





### es-qs
    
```
(EventID:"11" AND TargetFilename.keyword:(*\\\\Invoke\\-DllInjection.ps1 *\\\\Invoke\\-WmiCommand.ps1 *\\\\Get\\-GPPPassword.ps1 *\\\\Get\\-Keystrokes.ps1 *\\\\Get\\-VaultCredential.ps1 *\\\\Invoke\\-CredentialInjection.ps1 *\\\\Invoke\\-Mimikatz.ps1 *\\\\Invoke\\-NinjaCopy.ps1 *\\\\Invoke\\-TokenManipulation.ps1 *\\\\Out\\-Minidump.ps1 *\\\\VolumeShadowCopyTools.ps1 *\\\\Invoke\\-ReflectivePEInjection.ps1 *\\\\Get\\-TimedScreenshot.ps1 *\\\\Invoke\\-UserHunter.ps1 *\\\\Find\\-GPOLocation.ps1 *\\\\Invoke\\-ACLScanner.ps1 *\\\\Invoke\\-DowngradeAccount.ps1 *\\\\Get\\-ServiceUnquoted.ps1 *\\\\Get\\-ServiceFilePermission.ps1 *\\\\Get\\-ServicePermission.ps1 *\\\\Invoke\\-ServiceAbuse.ps1 *\\\\Install\\-ServiceBinary.ps1 *\\\\Get\\-RegAutoLogon.ps1 *\\\\Get\\-VulnAutoRun.ps1 *\\\\Get\\-VulnSchTask.ps1 *\\\\Get\\-UnattendedInstallFile.ps1 *\\\\Get\\-WebConfig.ps1 *\\\\Get\\-ApplicationHost.ps1 *\\\\Get\\-RegAlwaysInstallElevated.ps1 *\\\\Get\\-Unconstrained.ps1 *\\\\Add\\-RegBackdoor.ps1 *\\\\Add\\-ScrnSaveBackdoor.ps1 *\\\\Gupt\\-Backdoor.ps1 *\\\\Invoke\\-ADSBackdoor.ps1 *\\\\Enabled\\-DuplicateToken.ps1 *\\\\Invoke\\-PsUaCme.ps1 *\\\\Remove\\-Update.ps1 *\\\\Check\\-VM.ps1 *\\\\Get\\-LSASecret.ps1 *\\\\Get\\-PassHashes.ps1 *\\\\Show\\-TargetScreen.ps1 *\\\\Port\\-Scan.ps1 *\\\\Invoke\\-PoshRatHttp.ps1 *\\\\Invoke\\-PowerShellTCP.ps1 *\\\\Invoke\\-PowerShellWMI.ps1 *\\\\Add\\-Exfiltration.ps1 *\\\\Add\\-Persistence.ps1 *\\\\Do\\-Exfiltration.ps1 *\\\\Start\\-CaptureServer.ps1 *\\\\Invoke\\-ShellCode.ps1 *\\\\Get\\-ChromeDump.ps1 *\\\\Get\\-ClipboardContents.ps1 *\\\\Get\\-FoxDump.ps1 *\\\\Get\\-IndexedItem.ps1 *\\\\Get\\-Screenshot.ps1 *\\\\Invoke\\-Inveigh.ps1 *\\\\Invoke\\-NetRipper.ps1 *\\\\Invoke\\-EgressCheck.ps1 *\\\\Invoke\\-PostExfil.ps1 *\\\\Invoke\\-PSInject.ps1 *\\\\Invoke\\-RunAs.ps1 *\\\\MailRaider.ps1 *\\\\New\\-HoneyHash.ps1 *\\\\Set\\-MacAttribute.ps1 *\\\\Invoke\\-DCSync.ps1 *\\\\Invoke\\-PowerDump.ps1 *\\\\Exploit\\-Jboss.ps1 *\\\\Invoke\\-ThunderStruck.ps1 *\\\\Invoke\\-VoiceTroll.ps1 *\\\\Set\\-Wallpaper.ps1 *\\\\Invoke\\-InveighRelay.ps1 *\\\\Invoke\\-PsExec.ps1 *\\\\Invoke\\-SSHCommand.ps1 *\\\\Get\\-SecurityPackages.ps1 *\\\\Install\\-SSP.ps1 *\\\\Invoke\\-BackdoorLNK.ps1 *\\\\PowerBreach.ps1 *\\\\Get\\-SiteListPassword.ps1 *\\\\Get\\-System.ps1 *\\\\Invoke\\-BypassUAC.ps1 *\\\\Invoke\\-Tater.ps1 *\\\\Invoke\\-WScriptBypassUAC.ps1 *\\\\PowerUp.ps1 *\\\\PowerView.ps1 *\\\\Get\\-RickAstley.ps1 *\\\\Find\\-Fruit.ps1 *\\\\HTTP\\-Login.ps1 *\\\\Find\\-TrustedDocuments.ps1 *\\\\Invoke\\-Paranoia.ps1 *\\\\Invoke\\-WinEnum.ps1 *\\\\Invoke\\-ARPScan.ps1 *\\\\Invoke\\-PortScan.ps1 *\\\\Invoke\\-ReverseDNSLookup.ps1 *\\\\Invoke\\-SMBScanner.ps1 *\\\\Invoke\\-Mimikittenz.ps1))
```


### xpack-watcher
    
```
curl -s -XPUT -H \'Content-Type: application/json\' --data-binary @- localhost:9200/_watcher/watch/Malicious-PowerShell-Commandlet-Names <<EOF\n{\n  "metadata": {\n    "title": "Malicious PowerShell Commandlet Names",\n    "description": "Detects the creation of known powershell scripts for exploitation",\n    "tags": [\n      "attack.execution",\n      "attack.t1086"\n    ],\n    "query": "(EventID:\\"11\\" AND TargetFilename.keyword:(*\\\\\\\\Invoke\\\\-DllInjection.ps1 *\\\\\\\\Invoke\\\\-WmiCommand.ps1 *\\\\\\\\Get\\\\-GPPPassword.ps1 *\\\\\\\\Get\\\\-Keystrokes.ps1 *\\\\\\\\Get\\\\-VaultCredential.ps1 *\\\\\\\\Invoke\\\\-CredentialInjection.ps1 *\\\\\\\\Invoke\\\\-Mimikatz.ps1 *\\\\\\\\Invoke\\\\-NinjaCopy.ps1 *\\\\\\\\Invoke\\\\-TokenManipulation.ps1 *\\\\\\\\Out\\\\-Minidump.ps1 *\\\\\\\\VolumeShadowCopyTools.ps1 *\\\\\\\\Invoke\\\\-ReflectivePEInjection.ps1 *\\\\\\\\Get\\\\-TimedScreenshot.ps1 *\\\\\\\\Invoke\\\\-UserHunter.ps1 *\\\\\\\\Find\\\\-GPOLocation.ps1 *\\\\\\\\Invoke\\\\-ACLScanner.ps1 *\\\\\\\\Invoke\\\\-DowngradeAccount.ps1 *\\\\\\\\Get\\\\-ServiceUnquoted.ps1 *\\\\\\\\Get\\\\-ServiceFilePermission.ps1 *\\\\\\\\Get\\\\-ServicePermission.ps1 *\\\\\\\\Invoke\\\\-ServiceAbuse.ps1 *\\\\\\\\Install\\\\-ServiceBinary.ps1 *\\\\\\\\Get\\\\-RegAutoLogon.ps1 *\\\\\\\\Get\\\\-VulnAutoRun.ps1 *\\\\\\\\Get\\\\-VulnSchTask.ps1 *\\\\\\\\Get\\\\-UnattendedInstallFile.ps1 *\\\\\\\\Get\\\\-WebConfig.ps1 *\\\\\\\\Get\\\\-ApplicationHost.ps1 *\\\\\\\\Get\\\\-RegAlwaysInstallElevated.ps1 *\\\\\\\\Get\\\\-Unconstrained.ps1 *\\\\\\\\Add\\\\-RegBackdoor.ps1 *\\\\\\\\Add\\\\-ScrnSaveBackdoor.ps1 *\\\\\\\\Gupt\\\\-Backdoor.ps1 *\\\\\\\\Invoke\\\\-ADSBackdoor.ps1 *\\\\\\\\Enabled\\\\-DuplicateToken.ps1 *\\\\\\\\Invoke\\\\-PsUaCme.ps1 *\\\\\\\\Remove\\\\-Update.ps1 *\\\\\\\\Check\\\\-VM.ps1 *\\\\\\\\Get\\\\-LSASecret.ps1 *\\\\\\\\Get\\\\-PassHashes.ps1 *\\\\\\\\Show\\\\-TargetScreen.ps1 *\\\\\\\\Port\\\\-Scan.ps1 *\\\\\\\\Invoke\\\\-PoshRatHttp.ps1 *\\\\\\\\Invoke\\\\-PowerShellTCP.ps1 *\\\\\\\\Invoke\\\\-PowerShellWMI.ps1 *\\\\\\\\Add\\\\-Exfiltration.ps1 *\\\\\\\\Add\\\\-Persistence.ps1 *\\\\\\\\Do\\\\-Exfiltration.ps1 *\\\\\\\\Start\\\\-CaptureServer.ps1 *\\\\\\\\Invoke\\\\-ShellCode.ps1 *\\\\\\\\Get\\\\-ChromeDump.ps1 *\\\\\\\\Get\\\\-ClipboardContents.ps1 *\\\\\\\\Get\\\\-FoxDump.ps1 *\\\\\\\\Get\\\\-IndexedItem.ps1 *\\\\\\\\Get\\\\-Screenshot.ps1 *\\\\\\\\Invoke\\\\-Inveigh.ps1 *\\\\\\\\Invoke\\\\-NetRipper.ps1 *\\\\\\\\Invoke\\\\-EgressCheck.ps1 *\\\\\\\\Invoke\\\\-PostExfil.ps1 *\\\\\\\\Invoke\\\\-PSInject.ps1 *\\\\\\\\Invoke\\\\-RunAs.ps1 *\\\\\\\\MailRaider.ps1 *\\\\\\\\New\\\\-HoneyHash.ps1 *\\\\\\\\Set\\\\-MacAttribute.ps1 *\\\\\\\\Invoke\\\\-DCSync.ps1 *\\\\\\\\Invoke\\\\-PowerDump.ps1 *\\\\\\\\Exploit\\\\-Jboss.ps1 *\\\\\\\\Invoke\\\\-ThunderStruck.ps1 *\\\\\\\\Invoke\\\\-VoiceTroll.ps1 *\\\\\\\\Set\\\\-Wallpaper.ps1 *\\\\\\\\Invoke\\\\-InveighRelay.ps1 *\\\\\\\\Invoke\\\\-PsExec.ps1 *\\\\\\\\Invoke\\\\-SSHCommand.ps1 *\\\\\\\\Get\\\\-SecurityPackages.ps1 *\\\\\\\\Install\\\\-SSP.ps1 *\\\\\\\\Invoke\\\\-BackdoorLNK.ps1 *\\\\\\\\PowerBreach.ps1 *\\\\\\\\Get\\\\-SiteListPassword.ps1 *\\\\\\\\Get\\\\-System.ps1 *\\\\\\\\Invoke\\\\-BypassUAC.ps1 *\\\\\\\\Invoke\\\\-Tater.ps1 *\\\\\\\\Invoke\\\\-WScriptBypassUAC.ps1 *\\\\\\\\PowerUp.ps1 *\\\\\\\\PowerView.ps1 *\\\\\\\\Get\\\\-RickAstley.ps1 *\\\\\\\\Find\\\\-Fruit.ps1 *\\\\\\\\HTTP\\\\-Login.ps1 *\\\\\\\\Find\\\\-TrustedDocuments.ps1 *\\\\\\\\Invoke\\\\-Paranoia.ps1 *\\\\\\\\Invoke\\\\-WinEnum.ps1 *\\\\\\\\Invoke\\\\-ARPScan.ps1 *\\\\\\\\Invoke\\\\-PortScan.ps1 *\\\\\\\\Invoke\\\\-ReverseDNSLookup.ps1 *\\\\\\\\Invoke\\\\-SMBScanner.ps1 *\\\\\\\\Invoke\\\\-Mimikittenz.ps1))"\n  },\n  "trigger": {\n    "schedule": {\n      "interval": "30m"\n    }\n  },\n  "input": {\n    "search": {\n      "request": {\n        "body": {\n          "size": 0,\n          "query": {\n            "bool": {\n              "must": [\n                {\n                  "query_string": {\n                    "query": "(EventID:\\"11\\" AND TargetFilename.keyword:(*\\\\\\\\Invoke\\\\-DllInjection.ps1 *\\\\\\\\Invoke\\\\-WmiCommand.ps1 *\\\\\\\\Get\\\\-GPPPassword.ps1 *\\\\\\\\Get\\\\-Keystrokes.ps1 *\\\\\\\\Get\\\\-VaultCredential.ps1 *\\\\\\\\Invoke\\\\-CredentialInjection.ps1 *\\\\\\\\Invoke\\\\-Mimikatz.ps1 *\\\\\\\\Invoke\\\\-NinjaCopy.ps1 *\\\\\\\\Invoke\\\\-TokenManipulation.ps1 *\\\\\\\\Out\\\\-Minidump.ps1 *\\\\\\\\VolumeShadowCopyTools.ps1 *\\\\\\\\Invoke\\\\-ReflectivePEInjection.ps1 *\\\\\\\\Get\\\\-TimedScreenshot.ps1 *\\\\\\\\Invoke\\\\-UserHunter.ps1 *\\\\\\\\Find\\\\-GPOLocation.ps1 *\\\\\\\\Invoke\\\\-ACLScanner.ps1 *\\\\\\\\Invoke\\\\-DowngradeAccount.ps1 *\\\\\\\\Get\\\\-ServiceUnquoted.ps1 *\\\\\\\\Get\\\\-ServiceFilePermission.ps1 *\\\\\\\\Get\\\\-ServicePermission.ps1 *\\\\\\\\Invoke\\\\-ServiceAbuse.ps1 *\\\\\\\\Install\\\\-ServiceBinary.ps1 *\\\\\\\\Get\\\\-RegAutoLogon.ps1 *\\\\\\\\Get\\\\-VulnAutoRun.ps1 *\\\\\\\\Get\\\\-VulnSchTask.ps1 *\\\\\\\\Get\\\\-UnattendedInstallFile.ps1 *\\\\\\\\Get\\\\-WebConfig.ps1 *\\\\\\\\Get\\\\-ApplicationHost.ps1 *\\\\\\\\Get\\\\-RegAlwaysInstallElevated.ps1 *\\\\\\\\Get\\\\-Unconstrained.ps1 *\\\\\\\\Add\\\\-RegBackdoor.ps1 *\\\\\\\\Add\\\\-ScrnSaveBackdoor.ps1 *\\\\\\\\Gupt\\\\-Backdoor.ps1 *\\\\\\\\Invoke\\\\-ADSBackdoor.ps1 *\\\\\\\\Enabled\\\\-DuplicateToken.ps1 *\\\\\\\\Invoke\\\\-PsUaCme.ps1 *\\\\\\\\Remove\\\\-Update.ps1 *\\\\\\\\Check\\\\-VM.ps1 *\\\\\\\\Get\\\\-LSASecret.ps1 *\\\\\\\\Get\\\\-PassHashes.ps1 *\\\\\\\\Show\\\\-TargetScreen.ps1 *\\\\\\\\Port\\\\-Scan.ps1 *\\\\\\\\Invoke\\\\-PoshRatHttp.ps1 *\\\\\\\\Invoke\\\\-PowerShellTCP.ps1 *\\\\\\\\Invoke\\\\-PowerShellWMI.ps1 *\\\\\\\\Add\\\\-Exfiltration.ps1 *\\\\\\\\Add\\\\-Persistence.ps1 *\\\\\\\\Do\\\\-Exfiltration.ps1 *\\\\\\\\Start\\\\-CaptureServer.ps1 *\\\\\\\\Invoke\\\\-ShellCode.ps1 *\\\\\\\\Get\\\\-ChromeDump.ps1 *\\\\\\\\Get\\\\-ClipboardContents.ps1 *\\\\\\\\Get\\\\-FoxDump.ps1 *\\\\\\\\Get\\\\-IndexedItem.ps1 *\\\\\\\\Get\\\\-Screenshot.ps1 *\\\\\\\\Invoke\\\\-Inveigh.ps1 *\\\\\\\\Invoke\\\\-NetRipper.ps1 *\\\\\\\\Invoke\\\\-EgressCheck.ps1 *\\\\\\\\Invoke\\\\-PostExfil.ps1 *\\\\\\\\Invoke\\\\-PSInject.ps1 *\\\\\\\\Invoke\\\\-RunAs.ps1 *\\\\\\\\MailRaider.ps1 *\\\\\\\\New\\\\-HoneyHash.ps1 *\\\\\\\\Set\\\\-MacAttribute.ps1 *\\\\\\\\Invoke\\\\-DCSync.ps1 *\\\\\\\\Invoke\\\\-PowerDump.ps1 *\\\\\\\\Exploit\\\\-Jboss.ps1 *\\\\\\\\Invoke\\\\-ThunderStruck.ps1 *\\\\\\\\Invoke\\\\-VoiceTroll.ps1 *\\\\\\\\Set\\\\-Wallpaper.ps1 *\\\\\\\\Invoke\\\\-InveighRelay.ps1 *\\\\\\\\Invoke\\\\-PsExec.ps1 *\\\\\\\\Invoke\\\\-SSHCommand.ps1 *\\\\\\\\Get\\\\-SecurityPackages.ps1 *\\\\\\\\Install\\\\-SSP.ps1 *\\\\\\\\Invoke\\\\-BackdoorLNK.ps1 *\\\\\\\\PowerBreach.ps1 *\\\\\\\\Get\\\\-SiteListPassword.ps1 *\\\\\\\\Get\\\\-System.ps1 *\\\\\\\\Invoke\\\\-BypassUAC.ps1 *\\\\\\\\Invoke\\\\-Tater.ps1 *\\\\\\\\Invoke\\\\-WScriptBypassUAC.ps1 *\\\\\\\\PowerUp.ps1 *\\\\\\\\PowerView.ps1 *\\\\\\\\Get\\\\-RickAstley.ps1 *\\\\\\\\Find\\\\-Fruit.ps1 *\\\\\\\\HTTP\\\\-Login.ps1 *\\\\\\\\Find\\\\-TrustedDocuments.ps1 *\\\\\\\\Invoke\\\\-Paranoia.ps1 *\\\\\\\\Invoke\\\\-WinEnum.ps1 *\\\\\\\\Invoke\\\\-ARPScan.ps1 *\\\\\\\\Invoke\\\\-PortScan.ps1 *\\\\\\\\Invoke\\\\-ReverseDNSLookup.ps1 *\\\\\\\\Invoke\\\\-SMBScanner.ps1 *\\\\\\\\Invoke\\\\-Mimikittenz.ps1))",\n                    "analyze_wildcard": true\n                  }\n                }\n              ],\n              "filter": {\n                "range": {\n                  "timestamp": {\n                    "gte": "now-30m/m"\n                  }\n                }\n              }\n            }\n          }\n        },\n        "indices": []\n      }\n    }\n  },\n  "condition": {\n    "compare": {\n      "ctx.payload.hits.total": {\n        "not_eq": 0\n      }\n    }\n  },\n  "actions": {\n    "send_email": {\n      "email": {\n        "to": "root@localhost",\n        "subject": "Sigma Rule \'Malicious PowerShell Commandlet Names\'",\n        "body": "Hits:\\n{{#ctx.payload.hits.hits}}{{_source}}\\n================================================================================\\n{{/ctx.payload.hits.hits}}",\n        "attachments": {\n          "data.json": {\n            "data": {\n              "format": "json"\n            }\n          }\n        }\n      }\n    }\n  }\n}\nEOF\n
```


### graylog
    
```
(EventID:"11" AND TargetFilename:("*\\\\Invoke\\-DllInjection.ps1" "*\\\\Invoke\\-WmiCommand.ps1" "*\\\\Get\\-GPPPassword.ps1" "*\\\\Get\\-Keystrokes.ps1" "*\\\\Get\\-VaultCredential.ps1" "*\\\\Invoke\\-CredentialInjection.ps1" "*\\\\Invoke\\-Mimikatz.ps1" "*\\\\Invoke\\-NinjaCopy.ps1" "*\\\\Invoke\\-TokenManipulation.ps1" "*\\\\Out\\-Minidump.ps1" "*\\\\VolumeShadowCopyTools.ps1" "*\\\\Invoke\\-ReflectivePEInjection.ps1" "*\\\\Get\\-TimedScreenshot.ps1" "*\\\\Invoke\\-UserHunter.ps1" "*\\\\Find\\-GPOLocation.ps1" "*\\\\Invoke\\-ACLScanner.ps1" "*\\\\Invoke\\-DowngradeAccount.ps1" "*\\\\Get\\-ServiceUnquoted.ps1" "*\\\\Get\\-ServiceFilePermission.ps1" "*\\\\Get\\-ServicePermission.ps1" "*\\\\Invoke\\-ServiceAbuse.ps1" "*\\\\Install\\-ServiceBinary.ps1" "*\\\\Get\\-RegAutoLogon.ps1" "*\\\\Get\\-VulnAutoRun.ps1" "*\\\\Get\\-VulnSchTask.ps1" "*\\\\Get\\-UnattendedInstallFile.ps1" "*\\\\Get\\-WebConfig.ps1" "*\\\\Get\\-ApplicationHost.ps1" "*\\\\Get\\-RegAlwaysInstallElevated.ps1" "*\\\\Get\\-Unconstrained.ps1" "*\\\\Add\\-RegBackdoor.ps1" "*\\\\Add\\-ScrnSaveBackdoor.ps1" "*\\\\Gupt\\-Backdoor.ps1" "*\\\\Invoke\\-ADSBackdoor.ps1" "*\\\\Enabled\\-DuplicateToken.ps1" "*\\\\Invoke\\-PsUaCme.ps1" "*\\\\Remove\\-Update.ps1" "*\\\\Check\\-VM.ps1" "*\\\\Get\\-LSASecret.ps1" "*\\\\Get\\-PassHashes.ps1" "*\\\\Show\\-TargetScreen.ps1" "*\\\\Port\\-Scan.ps1" "*\\\\Invoke\\-PoshRatHttp.ps1" "*\\\\Invoke\\-PowerShellTCP.ps1" "*\\\\Invoke\\-PowerShellWMI.ps1" "*\\\\Add\\-Exfiltration.ps1" "*\\\\Add\\-Persistence.ps1" "*\\\\Do\\-Exfiltration.ps1" "*\\\\Start\\-CaptureServer.ps1" "*\\\\Invoke\\-ShellCode.ps1" "*\\\\Get\\-ChromeDump.ps1" "*\\\\Get\\-ClipboardContents.ps1" "*\\\\Get\\-FoxDump.ps1" "*\\\\Get\\-IndexedItem.ps1" "*\\\\Get\\-Screenshot.ps1" "*\\\\Invoke\\-Inveigh.ps1" "*\\\\Invoke\\-NetRipper.ps1" "*\\\\Invoke\\-EgressCheck.ps1" "*\\\\Invoke\\-PostExfil.ps1" "*\\\\Invoke\\-PSInject.ps1" "*\\\\Invoke\\-RunAs.ps1" "*\\\\MailRaider.ps1" "*\\\\New\\-HoneyHash.ps1" "*\\\\Set\\-MacAttribute.ps1" "*\\\\Invoke\\-DCSync.ps1" "*\\\\Invoke\\-PowerDump.ps1" "*\\\\Exploit\\-Jboss.ps1" "*\\\\Invoke\\-ThunderStruck.ps1" "*\\\\Invoke\\-VoiceTroll.ps1" "*\\\\Set\\-Wallpaper.ps1" "*\\\\Invoke\\-InveighRelay.ps1" "*\\\\Invoke\\-PsExec.ps1" "*\\\\Invoke\\-SSHCommand.ps1" "*\\\\Get\\-SecurityPackages.ps1" "*\\\\Install\\-SSP.ps1" "*\\\\Invoke\\-BackdoorLNK.ps1" "*\\\\PowerBreach.ps1" "*\\\\Get\\-SiteListPassword.ps1" "*\\\\Get\\-System.ps1" "*\\\\Invoke\\-BypassUAC.ps1" "*\\\\Invoke\\-Tater.ps1" "*\\\\Invoke\\-WScriptBypassUAC.ps1" "*\\\\PowerUp.ps1" "*\\\\PowerView.ps1" "*\\\\Get\\-RickAstley.ps1" "*\\\\Find\\-Fruit.ps1" "*\\\\HTTP\\-Login.ps1" "*\\\\Find\\-TrustedDocuments.ps1" "*\\\\Invoke\\-Paranoia.ps1" "*\\\\Invoke\\-WinEnum.ps1" "*\\\\Invoke\\-ARPScan.ps1" "*\\\\Invoke\\-PortScan.ps1" "*\\\\Invoke\\-ReverseDNSLookup.ps1" "*\\\\Invoke\\-SMBScanner.ps1" "*\\\\Invoke\\-Mimikittenz.ps1"))
```


### splunk
    
```
(EventID="11" (TargetFilename="*\\\\Invoke-DllInjection.ps1" OR TargetFilename="*\\\\Invoke-WmiCommand.ps1" OR TargetFilename="*\\\\Get-GPPPassword.ps1" OR TargetFilename="*\\\\Get-Keystrokes.ps1" OR TargetFilename="*\\\\Get-VaultCredential.ps1" OR TargetFilename="*\\\\Invoke-CredentialInjection.ps1" OR TargetFilename="*\\\\Invoke-Mimikatz.ps1" OR TargetFilename="*\\\\Invoke-NinjaCopy.ps1" OR TargetFilename="*\\\\Invoke-TokenManipulation.ps1" OR TargetFilename="*\\\\Out-Minidump.ps1" OR TargetFilename="*\\\\VolumeShadowCopyTools.ps1" OR TargetFilename="*\\\\Invoke-ReflectivePEInjection.ps1" OR TargetFilename="*\\\\Get-TimedScreenshot.ps1" OR TargetFilename="*\\\\Invoke-UserHunter.ps1" OR TargetFilename="*\\\\Find-GPOLocation.ps1" OR TargetFilename="*\\\\Invoke-ACLScanner.ps1" OR TargetFilename="*\\\\Invoke-DowngradeAccount.ps1" OR TargetFilename="*\\\\Get-ServiceUnquoted.ps1" OR TargetFilename="*\\\\Get-ServiceFilePermission.ps1" OR TargetFilename="*\\\\Get-ServicePermission.ps1" OR TargetFilename="*\\\\Invoke-ServiceAbuse.ps1" OR TargetFilename="*\\\\Install-ServiceBinary.ps1" OR TargetFilename="*\\\\Get-RegAutoLogon.ps1" OR TargetFilename="*\\\\Get-VulnAutoRun.ps1" OR TargetFilename="*\\\\Get-VulnSchTask.ps1" OR TargetFilename="*\\\\Get-UnattendedInstallFile.ps1" OR TargetFilename="*\\\\Get-WebConfig.ps1" OR TargetFilename="*\\\\Get-ApplicationHost.ps1" OR TargetFilename="*\\\\Get-RegAlwaysInstallElevated.ps1" OR TargetFilename="*\\\\Get-Unconstrained.ps1" OR TargetFilename="*\\\\Add-RegBackdoor.ps1" OR TargetFilename="*\\\\Add-ScrnSaveBackdoor.ps1" OR TargetFilename="*\\\\Gupt-Backdoor.ps1" OR TargetFilename="*\\\\Invoke-ADSBackdoor.ps1" OR TargetFilename="*\\\\Enabled-DuplicateToken.ps1" OR TargetFilename="*\\\\Invoke-PsUaCme.ps1" OR TargetFilename="*\\\\Remove-Update.ps1" OR TargetFilename="*\\\\Check-VM.ps1" OR TargetFilename="*\\\\Get-LSASecret.ps1" OR TargetFilename="*\\\\Get-PassHashes.ps1" OR TargetFilename="*\\\\Show-TargetScreen.ps1" OR TargetFilename="*\\\\Port-Scan.ps1" OR TargetFilename="*\\\\Invoke-PoshRatHttp.ps1" OR TargetFilename="*\\\\Invoke-PowerShellTCP.ps1" OR TargetFilename="*\\\\Invoke-PowerShellWMI.ps1" OR TargetFilename="*\\\\Add-Exfiltration.ps1" OR TargetFilename="*\\\\Add-Persistence.ps1" OR TargetFilename="*\\\\Do-Exfiltration.ps1" OR TargetFilename="*\\\\Start-CaptureServer.ps1" OR TargetFilename="*\\\\Invoke-ShellCode.ps1" OR TargetFilename="*\\\\Get-ChromeDump.ps1" OR TargetFilename="*\\\\Get-ClipboardContents.ps1" OR TargetFilename="*\\\\Get-FoxDump.ps1" OR TargetFilename="*\\\\Get-IndexedItem.ps1" OR TargetFilename="*\\\\Get-Screenshot.ps1" OR TargetFilename="*\\\\Invoke-Inveigh.ps1" OR TargetFilename="*\\\\Invoke-NetRipper.ps1" OR TargetFilename="*\\\\Invoke-EgressCheck.ps1" OR TargetFilename="*\\\\Invoke-PostExfil.ps1" OR TargetFilename="*\\\\Invoke-PSInject.ps1" OR TargetFilename="*\\\\Invoke-RunAs.ps1" OR TargetFilename="*\\\\MailRaider.ps1" OR TargetFilename="*\\\\New-HoneyHash.ps1" OR TargetFilename="*\\\\Set-MacAttribute.ps1" OR TargetFilename="*\\\\Invoke-DCSync.ps1" OR TargetFilename="*\\\\Invoke-PowerDump.ps1" OR TargetFilename="*\\\\Exploit-Jboss.ps1" OR TargetFilename="*\\\\Invoke-ThunderStruck.ps1" OR TargetFilename="*\\\\Invoke-VoiceTroll.ps1" OR TargetFilename="*\\\\Set-Wallpaper.ps1" OR TargetFilename="*\\\\Invoke-InveighRelay.ps1" OR TargetFilename="*\\\\Invoke-PsExec.ps1" OR TargetFilename="*\\\\Invoke-SSHCommand.ps1" OR TargetFilename="*\\\\Get-SecurityPackages.ps1" OR TargetFilename="*\\\\Install-SSP.ps1" OR TargetFilename="*\\\\Invoke-BackdoorLNK.ps1" OR TargetFilename="*\\\\PowerBreach.ps1" OR TargetFilename="*\\\\Get-SiteListPassword.ps1" OR TargetFilename="*\\\\Get-System.ps1" OR TargetFilename="*\\\\Invoke-BypassUAC.ps1" OR TargetFilename="*\\\\Invoke-Tater.ps1" OR TargetFilename="*\\\\Invoke-WScriptBypassUAC.ps1" OR TargetFilename="*\\\\PowerUp.ps1" OR TargetFilename="*\\\\PowerView.ps1" OR TargetFilename="*\\\\Get-RickAstley.ps1" OR TargetFilename="*\\\\Find-Fruit.ps1" OR TargetFilename="*\\\\HTTP-Login.ps1" OR TargetFilename="*\\\\Find-TrustedDocuments.ps1" OR TargetFilename="*\\\\Invoke-Paranoia.ps1" OR TargetFilename="*\\\\Invoke-WinEnum.ps1" OR TargetFilename="*\\\\Invoke-ARPScan.ps1" OR TargetFilename="*\\\\Invoke-PortScan.ps1" OR TargetFilename="*\\\\Invoke-ReverseDNSLookup.ps1" OR TargetFilename="*\\\\Invoke-SMBScanner.ps1" OR TargetFilename="*\\\\Invoke-Mimikittenz.ps1"))
```


### logpoint
    
```
(EventID="11" TargetFilename IN ["*\\\\Invoke-DllInjection.ps1", "*\\\\Invoke-WmiCommand.ps1", "*\\\\Get-GPPPassword.ps1", "*\\\\Get-Keystrokes.ps1", "*\\\\Get-VaultCredential.ps1", "*\\\\Invoke-CredentialInjection.ps1", "*\\\\Invoke-Mimikatz.ps1", "*\\\\Invoke-NinjaCopy.ps1", "*\\\\Invoke-TokenManipulation.ps1", "*\\\\Out-Minidump.ps1", "*\\\\VolumeShadowCopyTools.ps1", "*\\\\Invoke-ReflectivePEInjection.ps1", "*\\\\Get-TimedScreenshot.ps1", "*\\\\Invoke-UserHunter.ps1", "*\\\\Find-GPOLocation.ps1", "*\\\\Invoke-ACLScanner.ps1", "*\\\\Invoke-DowngradeAccount.ps1", "*\\\\Get-ServiceUnquoted.ps1", "*\\\\Get-ServiceFilePermission.ps1", "*\\\\Get-ServicePermission.ps1", "*\\\\Invoke-ServiceAbuse.ps1", "*\\\\Install-ServiceBinary.ps1", "*\\\\Get-RegAutoLogon.ps1", "*\\\\Get-VulnAutoRun.ps1", "*\\\\Get-VulnSchTask.ps1", "*\\\\Get-UnattendedInstallFile.ps1", "*\\\\Get-WebConfig.ps1", "*\\\\Get-ApplicationHost.ps1", "*\\\\Get-RegAlwaysInstallElevated.ps1", "*\\\\Get-Unconstrained.ps1", "*\\\\Add-RegBackdoor.ps1", "*\\\\Add-ScrnSaveBackdoor.ps1", "*\\\\Gupt-Backdoor.ps1", "*\\\\Invoke-ADSBackdoor.ps1", "*\\\\Enabled-DuplicateToken.ps1", "*\\\\Invoke-PsUaCme.ps1", "*\\\\Remove-Update.ps1", "*\\\\Check-VM.ps1", "*\\\\Get-LSASecret.ps1", "*\\\\Get-PassHashes.ps1", "*\\\\Show-TargetScreen.ps1", "*\\\\Port-Scan.ps1", "*\\\\Invoke-PoshRatHttp.ps1", "*\\\\Invoke-PowerShellTCP.ps1", "*\\\\Invoke-PowerShellWMI.ps1", "*\\\\Add-Exfiltration.ps1", "*\\\\Add-Persistence.ps1", "*\\\\Do-Exfiltration.ps1", "*\\\\Start-CaptureServer.ps1", "*\\\\Invoke-ShellCode.ps1", "*\\\\Get-ChromeDump.ps1", "*\\\\Get-ClipboardContents.ps1", "*\\\\Get-FoxDump.ps1", "*\\\\Get-IndexedItem.ps1", "*\\\\Get-Screenshot.ps1", "*\\\\Invoke-Inveigh.ps1", "*\\\\Invoke-NetRipper.ps1", "*\\\\Invoke-EgressCheck.ps1", "*\\\\Invoke-PostExfil.ps1", "*\\\\Invoke-PSInject.ps1", "*\\\\Invoke-RunAs.ps1", "*\\\\MailRaider.ps1", "*\\\\New-HoneyHash.ps1", "*\\\\Set-MacAttribute.ps1", "*\\\\Invoke-DCSync.ps1", "*\\\\Invoke-PowerDump.ps1", "*\\\\Exploit-Jboss.ps1", "*\\\\Invoke-ThunderStruck.ps1", "*\\\\Invoke-VoiceTroll.ps1", "*\\\\Set-Wallpaper.ps1", "*\\\\Invoke-InveighRelay.ps1", "*\\\\Invoke-PsExec.ps1", "*\\\\Invoke-SSHCommand.ps1", "*\\\\Get-SecurityPackages.ps1", "*\\\\Install-SSP.ps1", "*\\\\Invoke-BackdoorLNK.ps1", "*\\\\PowerBreach.ps1", "*\\\\Get-SiteListPassword.ps1", "*\\\\Get-System.ps1", "*\\\\Invoke-BypassUAC.ps1", "*\\\\Invoke-Tater.ps1", "*\\\\Invoke-WScriptBypassUAC.ps1", "*\\\\PowerUp.ps1", "*\\\\PowerView.ps1", "*\\\\Get-RickAstley.ps1", "*\\\\Find-Fruit.ps1", "*\\\\HTTP-Login.ps1", "*\\\\Find-TrustedDocuments.ps1", "*\\\\Invoke-Paranoia.ps1", "*\\\\Invoke-WinEnum.ps1", "*\\\\Invoke-ARPScan.ps1", "*\\\\Invoke-PortScan.ps1", "*\\\\Invoke-ReverseDNSLookup.ps1", "*\\\\Invoke-SMBScanner.ps1", "*\\\\Invoke-Mimikittenz.ps1"])
```


### grep
    
```
grep -P '^(?:.*(?=.*11)(?=.*(?:.*.*\\Invoke-DllInjection\\.ps1|.*.*\\Invoke-WmiCommand\\.ps1|.*.*\\Get-GPPPassword\\.ps1|.*.*\\Get-Keystrokes\\.ps1|.*.*\\Get-VaultCredential\\.ps1|.*.*\\Invoke-CredentialInjection\\.ps1|.*.*\\Invoke-Mimikatz\\.ps1|.*.*\\Invoke-NinjaCopy\\.ps1|.*.*\\Invoke-TokenManipulation\\.ps1|.*.*\\Out-Minidump\\.ps1|.*.*\\VolumeShadowCopyTools\\.ps1|.*.*\\Invoke-ReflectivePEInjection\\.ps1|.*.*\\Get-TimedScreenshot\\.ps1|.*.*\\Invoke-UserHunter\\.ps1|.*.*\\Find-GPOLocation\\.ps1|.*.*\\Invoke-ACLScanner\\.ps1|.*.*\\Invoke-DowngradeAccount\\.ps1|.*.*\\Get-ServiceUnquoted\\.ps1|.*.*\\Get-ServiceFilePermission\\.ps1|.*.*\\Get-ServicePermission\\.ps1|.*.*\\Invoke-ServiceAbuse\\.ps1|.*.*\\Install-ServiceBinary\\.ps1|.*.*\\Get-RegAutoLogon\\.ps1|.*.*\\Get-VulnAutoRun\\.ps1|.*.*\\Get-VulnSchTask\\.ps1|.*.*\\Get-UnattendedInstallFile\\.ps1|.*.*\\Get-WebConfig\\.ps1|.*.*\\Get-ApplicationHost\\.ps1|.*.*\\Get-RegAlwaysInstallElevated\\.ps1|.*.*\\Get-Unconstrained\\.ps1|.*.*\\Add-RegBackdoor\\.ps1|.*.*\\Add-ScrnSaveBackdoor\\.ps1|.*.*\\Gupt-Backdoor\\.ps1|.*.*\\Invoke-ADSBackdoor\\.ps1|.*.*\\Enabled-DuplicateToken\\.ps1|.*.*\\Invoke-PsUaCme\\.ps1|.*.*\\Remove-Update\\.ps1|.*.*\\Check-VM\\.ps1|.*.*\\Get-LSASecret\\.ps1|.*.*\\Get-PassHashes\\.ps1|.*.*\\Show-TargetScreen\\.ps1|.*.*\\Port-Scan\\.ps1|.*.*\\Invoke-PoshRatHttp\\.ps1|.*.*\\Invoke-PowerShellTCP\\.ps1|.*.*\\Invoke-PowerShellWMI\\.ps1|.*.*\\Add-Exfiltration\\.ps1|.*.*\\Add-Persistence\\.ps1|.*.*\\Do-Exfiltration\\.ps1|.*.*\\Start-CaptureServer\\.ps1|.*.*\\Invoke-ShellCode\\.ps1|.*.*\\Get-ChromeDump\\.ps1|.*.*\\Get-ClipboardContents\\.ps1|.*.*\\Get-FoxDump\\.ps1|.*.*\\Get-IndexedItem\\.ps1|.*.*\\Get-Screenshot\\.ps1|.*.*\\Invoke-Inveigh\\.ps1|.*.*\\Invoke-NetRipper\\.ps1|.*.*\\Invoke-EgressCheck\\.ps1|.*.*\\Invoke-PostExfil\\.ps1|.*.*\\Invoke-PSInject\\.ps1|.*.*\\Invoke-RunAs\\.ps1|.*.*\\MailRaider\\.ps1|.*.*\\New-HoneyHash\\.ps1|.*.*\\Set-MacAttribute\\.ps1|.*.*\\Invoke-DCSync\\.ps1|.*.*\\Invoke-PowerDump\\.ps1|.*.*\\Exploit-Jboss\\.ps1|.*.*\\Invoke-ThunderStruck\\.ps1|.*.*\\Invoke-VoiceTroll\\.ps1|.*.*\\Set-Wallpaper\\.ps1|.*.*\\Invoke-InveighRelay\\.ps1|.*.*\\Invoke-PsExec\\.ps1|.*.*\\Invoke-SSHCommand\\.ps1|.*.*\\Get-SecurityPackages\\.ps1|.*.*\\Install-SSP\\.ps1|.*.*\\Invoke-BackdoorLNK\\.ps1|.*.*\\PowerBreach\\.ps1|.*.*\\Get-SiteListPassword\\.ps1|.*.*\\Get-System\\.ps1|.*.*\\Invoke-BypassUAC\\.ps1|.*.*\\Invoke-Tater\\.ps1|.*.*\\Invoke-WScriptBypassUAC\\.ps1|.*.*\\PowerUp\\.ps1|.*.*\\PowerView\\.ps1|.*.*\\Get-RickAstley\\.ps1|.*.*\\Find-Fruit\\.ps1|.*.*\\HTTP-Login\\.ps1|.*.*\\Find-TrustedDocuments\\.ps1|.*.*\\Invoke-Paranoia\\.ps1|.*.*\\Invoke-WinEnum\\.ps1|.*.*\\Invoke-ARPScan\\.ps1|.*.*\\Invoke-PortScan\\.ps1|.*.*\\Invoke-ReverseDNSLookup\\.ps1|.*.*\\Invoke-SMBScanner\\.ps1|.*.*\\Invoke-Mimikittenz\\.ps1)))'
```



